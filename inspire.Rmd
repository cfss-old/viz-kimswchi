---
title: "Inspire"
author: "Soo Wan Kim"
date: "April 25, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)

issues <- read.csv("Data/inspire_issues.csv") %>%
  rename(Issue = `ï..Issue`)

cat <- read.csv("Data/inspire_catalogue.csv") %>%
  rename(Issue = `ï..Issue`) %>%
  transform(Issue = as.double(Issue)) %>%
  transform(NumPages = as.double(NumPages)) %>%
  transform(ItemType = as.character(ItemType)) %>%
  transform(ItemType = ifelse(ItemType %in% c("Poetry", "Photography"), "Art and Poetry", ItemType)) %>%
  transform(ItemType = as.factor(ItemType))
  
cat_type <- cat %>%
  group_by(ItemType) %>%
  summarize(SumPages = sum(NumPages)) %>%
  arrange(SumPages)

cat$ItemType <- factor(cat$ItemType, levels(cat$ItemType)[cat_type$ItemType])

cat_issue_type <- cat %>%
  group_by(Issue, ItemType) %>%
  summarize(SumPages = sum(NumPages)) %>%
  ungroup()

find_missing_type <- function(issue) {
  data = dplyr::filter(cat_issue_type, Issue == issue)
  TypeList = data$ItemType
  missing = cat_type$ItemType[!cat_type$ItemType %in% TypeList]
  
  return(missing)
}

make_row <- function(issue, missing_type) {
  row = t(as_tibble(c(issue, missing_type, 0)))
  colnames(row) <- c("Issue", "ItemType", "SumPages")
  row = as.data.frame(row)
  rownames(row) <- NULL
  return(row)
}

make_rows <- function(issue) {
  missing = find_missing_type(issue)
  missing_rows = make_row(issue, as.character(missing[1]))
  if (length(missing) > 1) {
    for (x in tail(missing, -1)) {
    missing_rows = rbind(missing_rows, make_row(issue, as.character(x)))
    }
  }
  else {
    missing_rows = missing_rows
  }
  
  return(missing_rows)
}

missing_rows <- make_rows(1)
for (x in seq(2,16)) {
  missing_rows <- rbind(missing_rows, make_rows(x))
}

missing_rows <- missing_rows %>%
  transform(Issue = as.numeric(Issue)) %>%
  transform(SumPages = as.numeric(SumPages) - 1)

cat_issue_type <- rbind(cat_issue_type, missing_rows) %>%
  arrange(Issue) %>%
  na.omit()

TotPages <- cat %>%
  group_by(Issue) %>%
  summarize(TotalPages = sum(NumPages))

cat_issue_type <- left_join(cat_issue_type, TotPages) %>%
  mutate(SharePages = SumPages/TotalPages)

rep1 <- cat_issue_type %>%
  filter(Issue < 16) %>%
  transform(Issue = Issue + 0.5)

rep2 <- cat_issue_type %>%
  filter(Issue < 16) %>%
  transform(Issue = Issue + 0.9)

cat_join <- rbind(cat_issue_type, rbind(rep1, rep2))

https://www.r-bloggers.com/timeline-graph-with-ggplot2/
http://stackoverflow.com/questions/7492274/draw-a-chronological-timeline-with-ggplot2
http://jason.bryer.org/timeline/
http://www.statsblogs.com/2012/07/07/timeline-graph-with-ggplot2/  
  
ggplot(filter(cat_join, Issue < 2),
       aes(Issue, NumPages, fill = ItemType)) + 
  geom_area() + 
  scale_x_continuous(breaks = seq(1,16,1))
  
ggplot(filter(cat, Issue < 2)) + 
  geom_area(stat = "bin", aes(y = NumPages, fill = ItemType))

set.seed(345)
Sector <- rep(c("S01","S02","S03","S04","S05","S06","S07"),times=7)
Year <- as.numeric(rep(c("1950","1960","1970","1980","1990","2000","2010"),each=7))
Value <- runif(49, 10, 100)
data <- data.frame(Sector,Year,Value)

ggplot(data, aes(x=Year, y=Value, fill=Sector)) + 
    geom_area()

ggplot(cat_issue_type, aes(x=Issue, y=SumPages, fill=ItemType)) + 
  geom_area() + 
  scale_x_continuous(breaks = seq(1, 16, 1))

ggplot(cat_issue_type, aes(x=Issue, y=SharePages, fill=ItemType)) + 
  geom_area(color = "black") + 
  scale_x_continuous(breaks = seq(1, 16, 1))

ggplot(cat_join, aes(x=Issue, y=SharePages, fill=ItemType)) + 
  geom_area() + 
  scale_x_continuous(breaks = seq(1, 16, 1))

cat_join$ItemType <- factor(cat_join$ItemType, levels = cat_type$ItemType)

x = 6
ggplot(filter(cat_join, Issue == x), 
       aes(ItemType, SharePages, fill=ItemType)) + 
  geom_bar(stat="identity") + 
  coord_flip()
#reverse order of legend

cat_type <- cat_type %>%
  mutate(Issue = 1) %>%
  mutate(Share = SumPages/sum(SumPages))

cat_type$ItemType <- factor(cat_type$ItemType, levels = cat_type$ItemType)

cat_type2 <- cat_type %>%
  transform(Issue = 1.999)

cat_type <- rbind(cat_type, cat_type2)

ggplot(filter(cat_type, Issue < 2), 
       aes(x=Issue, y=Share, fill=ItemType)) + 
  geom_area(color = "black")


```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
